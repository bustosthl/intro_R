{
  "hash": "2aa728568ff9b45f408c8e0cb6aa1b97",
  "result": {
    "engine": "knitr",
    "markdown": "# 4. Visualización\n\nEn este apartado nos enfocaremos en entender por qué visualizar datos y cómo construirlos utilizando `ggplot()`.\n\n## 4.1. Pregunta-problema\n\nCaracterizar la territorialidad del voto en la Provincia de Buenos Aires.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\ndata <- read_csv(\"data/encuentro_1/ARG_elecciones.csv\")\n\nhead(data,2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 10\n  id         seccion Elecciones Partido Porcentaje Votos Participacion electores\n  <chr>      <chr>   <chr>      <chr>        <dbl> <dbl>         <dbl>     <dbl>\n1 BUENOS AI… Adolfo… BALLOTAGE… BLANCO        1.19   134          79.2     14171\n2 BUENOS AI… Albert… BALLOTAGE… BLANCO        1.6    123          84.2      9147\n# ℹ 2 more variables: votantes <dbl>, Provincia <chr>\n```\n\n\n:::\n:::\n\n\n## 4.2. ¿Por qué visualizar?\n\n::: callout-note\n## Atención\n\nLa visualización de datos es parte arte y parte ciencia y, como bien dice [Claus Wilke](https://clauswilke.com/dataviz/introduction.html), el desafío es realizar correctamente el arte sin desfigurar la ciencia (y viceversa).\n:::\n\nHay tres razones centrales por las que visualizamos la información:\n\n-   **Explorar los datos**: hay relaciones que podemos malinterpretar si sólo miramos métricas resumen.\n\n-   **Expresar relaciones complejas**: no siempre las tablas nos van a permitir ver con claridad cuando hay mucha información involucrada.\n\n-   **Comunicar**: en general, construimos información para contársela a otras personas. Probablemente sea más fácil de contar una historia con un gráfico que con una tabla, por ejemplo.\n\n::: {.panel-tabset .nav-pills}\n## Explorar los datos\n\nUn gran ejemplo para mostrar lo importante de visualizar los datos es el llamado **Cuarteto de Anscombe**.\n\n![](img/cuarteto_anscombe.jpg)\n\n## Expresar relaciones complejas\n\nHans Rosling fundó el proyecto [Gapminder](https://www.gapminder.org/tools/#$chart-type=bubbles&url=v2) y popularizó la siguiente visualización. [Aquí está disponible con la explicación del autor](https://www.youtube.com/watch?v=dfa7B8LPGOE).\n\n![](img/gapminder.png)\n\n## Comunicar\n\n::: {#fig-inscriptos layout-ncol=\"2\"}\nDos ejemplos de visualizaciones que tienen muy en claro qué es lo que quieren comunicar. Una disposición de la información que acompaña y refuerza el mensaje.\n\n![](img/inscriptos_uba_gral.png){#fig-gral}\n\n![](img/inscriptos_uba_socio.png){#fig-socio}\n\nFuente: [Chequeado](https://chequeado.com/el-explicador/carreras-universitarias-en-los-ultimos-7-anos-hay-cada-vez-mas-inscriptos-en-exactas-medicina-e-ingenieria-y-cada-vez-menos-en-sociales/)\n:::\n:::\n\n## 4.3. Construyendo un gráfico en `ggplot()`\n\nHagamos una tabla con los votos al PJ en las distintas elecciones en la Provincia de Buenos Aires.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncols_pj <- c(\"FRENTE PARA LA VICTORIA\",\"UNION POR LA PATRIA\",\"FRENTE DE TODOS\")\norden <- c(\"P2011\", \"G2011\",\n\"P2015\", \"G2015\",\"B2015\",\n\"P2019\", \"G2019\",\n\"P2023\", \"G2023\",\"B2023\")\n\ntab_pj <- data %>% \n  filter(Provincia==\"BUENOS AIRES\") %>% \n  separate_wider_delim(Elecciones, \" \", names = c(\"tipo_eleccion\", \"anio_eleccion\"), cols_remove=FALSE) %>% \n  group_by(Elecciones, tipo_eleccion, anio_eleccion, Partido) %>% \n  summarise(votos = sum(Votos), \n            electores = sum(electores),\n            votantes = sum(votantes)) %>% \n  mutate(votos_per = votos / votantes,\n         participacion = votantes / electores,\n         Elecciones = str_replace(Elecciones, \"PASO \",\"P\"),\n         Elecciones = str_replace(Elecciones, \"GENERALES \",\"G\"),\n         Elecciones = str_replace(Elecciones, \"BALLOTAGE \",\"B\"),\n         Elecciones = factor(Elecciones, orden)\n         ) %>% \n  filter(Partido %in% cols_pj)\ntab_pj\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 9\n# Groups:   Elecciones, tipo_eleccion, anio_eleccion [10]\n   Elecciones tipo_eleccion anio_eleccion Partido       votos electores votantes\n   <fct>      <chr>         <chr>         <chr>         <dbl>     <dbl>    <dbl>\n 1 B2015      BALLOTAGE     2015          FRENTE PARA… 4.83e6  11756541  9700855\n 2 B2023      BALLOTAGE     2023          UNION POR L… 4.92e6  13133726 10017387\n 3 G2011      GENERALES     2011          FRENTE PARA… 4.70e6  10574461  8715437\n 4 G2015      GENERALES     2015          FRENTE PARA… 3.42e6  12033279  9494724\n 5 G2019      GENERALES     2019          FRENTE DE T… 5.03e6  11995955  9882295\n 6 G2023      GENERALES     2023          UNION POR L… 4.22e6  13124435 10199399\n 7 P2011      PASO          2011          FRENTE PARA… 4.22e6  10818764  8540638\n 8 P2015      PASO          2015          FRENTE PARA… 3.24e6  11866173  8686139\n 9 P2019      PASO          2019          FRENTE DE T… 4.66e6  12348284  9279760\n10 P2023      PASO          2023          UNION POR L… 2.83e6  13115144  8902113\n# ℹ 2 more variables: votos_per <dbl>, participacion <dbl>\n```\n\n\n:::\n:::\n\n\nLa librería estrella de la visualización en `Tidyverse` funciona a través de **capas**. Cada una se corresponde con funciones diferentes dentro de la visualización.\n\n![](img/ggplot_esquema.png)\n\nCon `ggplot()` simplemente vamos a establecer un lienzo vacío. En este caso, ya recibe la tabla con la información.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_pj %>% \n  ggplot()\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nLuego definimos las **asignaciones estéticas**: la relación entre las variables y ciertos elementos de los gráficos (ejes/coordenadas o distintos atributos como color, tamaño, forma, etc.).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_pj %>% \n  ggplot(aes(x=factor(Elecciones,orden), y=participacion))\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nLa siguiente definición es de los **elementos geométricos** con los que vamos a representar los datos definidos con anterioridad.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_pj %>% \n  ggplot(aes(x=factor(Elecciones,orden), y=participacion))+\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# intentamos con otro tipo de gráfico\ntab_pj %>% \n  ggplot(aes(x=factor(Elecciones,orden), y=participacion))+\n  geom_col()\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# intentamos con DOS gráficos\ntab_pj %>% \n  ggplot(aes(x=factor(Elecciones,orden), y=participacion))+\n  geom_col(width=0.1, fill=\"violet\")+\n  geom_point(color=\"violet\", size=7)\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n\n```{.r .cell-code}\n# intentamos con TRES gráficos\ntab_pj %>% \n  ggplot(aes(x=factor(Elecciones,orden), y=participacion))+\n  geom_col(width=0.1, fill=\"violet\")+\n  geom_point(color=\"violet\", size=7)+\n  geom_line(aes(group=1),color=\"black\")\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-5-4.png){width=672}\n:::\n:::\n\n\nSe pueden agregar otros atributos. `Color` se utiliza para líneas y puntos; `fill` se utiliza para las áreas de los gráficos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_pj %>% \n  ggplot(aes(x=factor(Elecciones,orden), y=votos_per, color=Partido, shape=anio_eleccion))+\n  geom_point(size=3, stroke=3)\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# intentamos con otro tipo de gráfico\ntab_pj %>% \n  ggplot(aes(x=factor(Elecciones,orden), y=votos_per, fill=Partido))+\n  geom_col()\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# si se define por fuera del aes() funciona como atributo general\ntab_pj %>% \n  ggplot(aes(x=factor(Elecciones,orden), y=votos_per))+\n  geom_col(fill=\"red\")\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n:::\n\n\nEl siguiente elemento que podríamos incorporar tiene que ver con definir el tipo de paleta de colores a utilizar, los límites de los ejes u otras cuestiones que no afectan a lo esencial del gráfico pero ayudan a comunicar el punto.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_pj %>% \n  ggplot(aes(x=factor(Elecciones,orden), y=votos_per, fill=Partido))+\n  geom_col()+\n  ylim(0,1)+ # ponemos límites entre 0 y 100%\n  scale_fill_viridis_d() # viridis es una paleta de colores en particular\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nCuando hablamos de **facetado** nos referimos a separar los gráficos en partes según alguna variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_pj %>% \n  ggplot(aes(x=factor(Elecciones,orden), y=votos_per, fill=Partido))+\n  geom_col()+\n  ylim(0,0.7)+ # ponemos límites entre 0 y 100%\n  scale_fill_viridis_d()+ # viridis es una paleta de colores en particular\n  facet_wrap(~tipo_eleccion, scales = \"free\")\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nLo último que nos interesa ver aquí son los temas, que comprenden los elementos visuales que no son controlados por la información propiamente dicha.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_pj %>% \n  ggplot(aes(x=factor(Elecciones,orden), y=votos_per, fill=Partido))+\n  geom_col()+\n  ylim(0,0.7)+ # ponemos límites entre 0 y 100%\n  scale_fill_viridis_d()+ # viridis es una paleta de colores en particular\n  facet_wrap(~anio_eleccion, scales = \"free\", ncol=4)+\n  theme_minimal()+ # agregamos definiciones generales\n  theme(legend.position=\"bottom\",  \n        axis.line = element_line(linewidth = 0.75),\n        axis.line.x.bottom = element_line(colour = \"blue\")) # acá podemos definir elementos particulares\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# veamos una versión publicable\ntab_pj %>% \n  ggplot(aes(x=factor(Elecciones,orden), y=votos_per, fill=Partido))+\n  geom_col()+\n  scale_y_continuous(limits=c(0,0.7), labels = scales::percent_format(accuracy = 1))+\n  scale_fill_viridis_d()+ # viridis es una paleta de colores en particular\n  facet_wrap(~anio_eleccion, scales = \"free\", ncol=4)+\n  theme_minimal()+ # agregamos definiciones generales\n  theme(legend.position=\"bottom\")+ # acá podemos definir elementos particulares\n  labs(title=\"Resultados electorales del peronismo\",\n       subtitle=\"Provincia de Buenos Aires 2011-2023\",\n       x=\"\", y=\"\", caption = \"Elaboración propia según DINE (provisorios)\")\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# cambiemos los límites por las etiquetas\ntab_pj %>% \n  mutate(tipo_eleccion = case_when(tipo_eleccion == \"GENERALES\" ~\"GRAL\",\n                                   tipo_eleccion == \"BALLOTAGE\" ~\"BALOTAJE\", \n                                   .default = as.character(tipo_eleccion))) %>% \n  ggplot(aes(x=factor(tipo_eleccion,c(\"PASO\",\"GRAL\",\"BALOTAJE\")), y=votos_per, fill=Partido))+\n  geom_col()+\n  geom_text(aes(label=paste0(round(votos_per*100),\"%\"), y=votos_per+0.05))+\n  scale_y_continuous(limits=c(0,0.7), breaks=NULL)+\n  scale_fill_viridis_d(breaks=c(\"FRENTE PARA LA VICTORIA\", \"FRENTE DE TODOS\", \"UNION POR LA PATRIA\"))+ # viridis es una paleta de colores en particular\n  facet_wrap(~anio_eleccion, scales = \"free\", ncol=4)+\n  theme_minimal()+ # agregamos definiciones generales\n  theme(legend.position=\"bottom\")+ # acá podemos definir elementos particulares\n  labs(title=\"Resultados electorales del peronismo\",\n       subtitle=\"Provincia de Buenos Aires 2011-2023\",\n       caption = \"Elaboración propia según DINE (provisorios)\", \n       x=\"\", y=\"\", fill=\"\")\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-9-3.png){width=672}\n:::\n:::\n\n\n## 4.4. El qué antecede al cómo\n\nElegir un gráfico no es una *mera* cuestión artística: hay distintos tipos de gráficos según *qué* se quiere mostrar. Para investigar un poco más, dejo dos recursos: una [infografía](https://raw.githubusercontent.com/Financial-Times/chart-doctor/main/visual-vocabulary/poster.png) sobre distintos tipos de gráficos y el [proyecto Dataviz](https://datavizproject.com/) que funciona como una guía para elegir. Veamos algunos ejemplos.\n\n::: {.panel-tabset .nav-pills}\n## Distribuciones\n\nSi queremos ver una sola distribución (o dos) podemos usar un histograma o un gráfico de densidad. Para comparar entre varias, la mejor opción es el gráfico de cajas.\n\n\n::: {.cell .column-screen-inset-shaded layout-nrow=\"1\"}\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n:::\n\n\n## Parte-de-un-todo\n\nSi queremos resaltar que estamos mostrando partes de un todo los gráficos de tortas/anillos y las barras apiladas van a ser nuestras mejores opciones. \n\n\n::: {.cell .column-screen-inset-shaded layout-nrow=\"1\"}\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-11-2.png){width=672}\n:::\n:::\n\n:::\n\n## 4.5. Yapa: Mapas\n\nPara trabajar información geográfica se utiliza una librería llamada `sf`. Los archivos de tipo geográfico tienen una particularidad: llevan una columna (en general llamada *geometry*) donde se indica la posición de cada fila en el espacio. \n\nCarguemos los circuitos electorales disponibles en el portal de datos abiertos de la Provincia de Buenos Aires: https://catalogo.datos.gba.gob.ar/tr/dataset/circuitos-electorales. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\ngeo_dpto <- read_sf(\"data/encuentro_4/pba_departamentos.geojson\") %>% \nmutate(dpto_clean = tolower(dpto_clean))\ngeo_seccp <- read_sf(\"data/encuentro_4/pba_seccprovincial.geojson\") %>%\nst_buffer(0.01) %>% \nmutate(sp_clean = str_replace(seccionprovincial_nombre, \"Sección \", \"\"),\nsp_clean = case_when(sp_clean == \"Primera\"~\"S1\",\nsp_clean == \"Segunda\"~\"S2\",\nsp_clean == \"Tercera\"~\"S3\",\nsp_clean == \"Cuarta\"~\"S4\",\nsp_clean == \"Quinta\"~\"S5\",\nsp_clean == \"Sexta\"~\"S6\",\nsp_clean == \"Séptima\"~\"S7\",\nsp_clean == \"Capital\"~\"S8\"))\n\nggplot()+\ngeom_sf(data=geo_dpto, aes(fill=dpto_clean),show.legend=FALSE)+\ngeom_sf(data=geo_seccp, color=\"black\", fill=NA, lwd=1)+\ngeom_label(data=geo_seccp, \naes(label=sp_clean, \nx=as.data.frame(st_coordinates(st_centroid(geo_seccp)))$X, y=as.data.frame(st_coordinates(st_centroid(geo_seccp)))$Y),\nsize=3, position=position_jitter(width=.3, height=.3), label.padding=unit(0.1, \"lines\"))+\ntheme_void()+labs(title=\"Departamentos y secciones provinciales\", subtitle=\"Provincia de Buenos Aires\")\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nHacemos una unión con los resultados electorales. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ngeo_resultados <- data %>% \nfilter(Provincia==\"BUENOS AIRES\") %>% \nmutate(dpto_clean = str_replace(seccion, \", Buenos Aires\", \"\"),\ndpto_clean = tolower(dpto_clean),\ndpto_clean = str_replace(dpto_clean, \"adolfo gonzales chaves\", \"a. gonzales chaves\"),\ndpto_clean = str_replace(dpto_clean, \"general madariaga\", \"general juan madariaga\"),\ndpto_clean = str_replace(dpto_clean, \"coronel rosales\", \"cnel. de marina l.rosales\"),\ndpto_clean = str_replace(dpto_clean, \"cañuelas\", \"ca?uelas\"),\ndpto_clean = str_replace(dpto_clean, \"general la madrid\", \"general lamadrid\")) %>% \nleft_join(geo_dpto) %>%\nst_as_sf()\n\ngeo_resultados <- geo_resultados %>% \nfilter(Elecciones==\"GENERALES 2023\" & Partido != \"IMPUGNADO\"& Partido != \"NULO\") %>% \nmutate(Partido = case_when(Partido==\"FRENTE DE IZQUIERDA Y DE TRABAJADORES - UNIDAD\"~\"FIT-U\",\nPartido==\"HACEMOS POR NUESTRO PAIS\"~\"HNP\", .default = as.character(Partido))) \n\ngeo_resultados %>% \ngroup_by(Partido) %>% \nmutate(Porcentaje_norm=(Porcentaje - min(Porcentaje)) / (max(Porcentaje)-min(Porcentaje)) ) %>% \nungroup() %>% \nggplot()+\ngeom_sf(aes(fill=Porcentaje_norm))+\nfacet_wrap(~Partido)+\nscale_fill_viridis_c()+\ntheme_void()+\nlabs(fill=\"Porcentaje (min-max)\")+ guides(fill=guide_colorbar(ticks.colour = NA))\n```\n\n::: {.cell-output-display}\n![](viz_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n## 4.6. Para seguir practicando\n",
    "supporting": [
      "viz_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}